2:I[4707,[],""]
3:I[6423,[],""]
4:I[4888,["972","static/chunks/972-2edfdfc833581105.js","185","static/chunks/app/layout-f3b52d8364ca85ec.js"],"GoogleAnalytics"]
5:I[5268,["972","static/chunks/972-2edfdfc833581105.js","185","static/chunks/app/layout-f3b52d8364ca85ec.js"],"Providers"]
6:I[5582,["972","static/chunks/972-2edfdfc833581105.js","185","static/chunks/app/layout-f3b52d8364ca85ec.js"],"Layout"]
7:I[5878,["878","static/chunks/878-65f6c5ceb409fdbc.js","363","static/chunks/app/writeups/web-app-deployment-using-pm2-in-aws/page-aa777eef84994aa4.js"],"Image"]
8:I[2972,["878","static/chunks/878-65f6c5ceb409fdbc.js","972","static/chunks/972-2edfdfc833581105.js","160","static/chunks/app/not-found-260bcb2660817f5a.js"],""]
0:["yuIc8Ch0R9TxHLuIE9KTN",[[["",{"children":["writeups",{"children":["web-app-deployment-using-pm2-in-aws",{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",{"children":["writeups",{"children":["web-app-deployment-using-pm2-in-aws",{"children":["__PAGE__",{},[["$L1",["$","div",null,{"className":"sm:px-8 mx-2 mt-16 sm:mx-6","children":["$","div",null,{"className":"mx-auto w-full max-w-7xl lg:px-8","children":["$","div",null,{"className":"relative px-4 sm:px-8 lg:px-12","children":["$","div",null,{"className":"mx-auto max-w-2xl lg:max-w-5xl","children":["$","div",null,{"className":"xl:relative","children":["$","div",null,{"className":"mx-auto max-w-2xl","children":["$","writeup",null,{"children":[["$","header",null,{"className":"flex flex-col","children":[["$","h1",null,{"className":"mt-6 text-3xl font-bold tracking-tight text-zinc-800 md:text-5xl dark:text-zinc-100","children":"Web-App Deployment using PM2 in AWS"}],["$","time",null,{"dateTime":"2024-08-20","className":"order-first flex items-center text-sm text-zinc-400 md:text-base dark:text-zinc-500","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","className":"mr-1 h-4 w-4","children":["$","path",null,{"d":"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}]}],["$","span",null,{"className":"ml-1","children":"August 20, 2024"}],["$","span",null,{"className":"ml-1","children":["• by ",["$","a",null,{"href":"/","className":"hover:text-sky-500 hover:underline","children":"Irfanadziri"}]]}]]}]]}],["$","div",null,{"className":"mt-8 prose dark:prose-invert","data-mdx-content":true,"children":[["$","p",null,{"children":"Deploying web applications on AWS EC2 instances is a common task for cloud engineers. However, ensuring that the deployment is seamless, automated, and manageable requires careful consideration of the tools and configurations used. This guide walks through the process of deploying a web application using PM2 on an AWS EC2 instance, leveraging a Launch Template for consistency and efficiency, and implementing a semi CI/CD pipeline using S3."}],"\n",["$","h2",null,{"children":"Setting Up the EC2 Launch Template"}],"\n",["$","p",null,{"children":"To streamline the creation of EC2 instances, an AWS Launch Template is used. This template specifies the instance type, AMI, security group, and user data script that configures the instance upon launch."}],"\n",["$","p",null,{"children":"Here’s the configuration for the Launch Template:"}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml","children":[["$","span",null,{"className":"token key atrule","children":"LaunchTemplate"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n  ",["$","span",null,{"className":"token key atrule","children":"Type"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"'AWS::EC2::LaunchTemplate'"}],"\n  ",["$","span",null,{"className":"token key atrule","children":"Properties"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n    ",["$","span",null,{"className":"token key atrule","children":"LaunchTemplateData"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"InstanceType"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"'c5a.large'"}]," ",["$","span",null,{"className":"token comment","children":"# Compute optimized instance with 2 vCPU and 4 GiB memory"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"ImageId"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"'ami-060e277c0d4cce553'"}]," ",["$","span",null,{"className":"token comment","children":"# Ubuntu 22.04 LTS image"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"KeyName"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"'<keypair-name>'"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"IamInstanceProfile"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n        ",["$","span",null,{"className":"token key atrule","children":"Name"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"'<IAM-instance-profile-name>'"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"SecurityGroupIds"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n        ",["$","span",null,{"className":"token punctuation","children":"-"}]," ",["$","span",null,{"className":"token string","children":"'<security-group-id>'"}],"\n      ",["$","span",null,{"className":"token key atrule","children":"UserData"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n        ",["$","span",null,{"className":"token key atrule","children":"Fn::Base64"}],["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token scalar string","children":"\n          #!/bin/bash -l"}],"\n\n          ",["$","span",null,{"className":"token comment","children":"# Update package index"}],"\n          apt update\n\n          ",["$","span",null,{"className":"token comment","children":"# Install necessary packages"}],"\n          apt install ",["$","span",null,{"className":"token punctuation","children":"-"}],"y nginx unzip curl\n\n          ",["$","span",null,{"className":"token comment","children":"# Install NVM (Node Version Manager)"}],"\n          curl ",["$","span",null,{"className":"token punctuation","children":"-"}],"o",["$","span",null,{"className":"token punctuation","children":"-"}]," https",["$","span",null,{"className":"token punctuation","children":":"}],"//raw.githubusercontent.com/nvm",["$","span",null,{"className":"token punctuation","children":"-"}],"sh/nvm/v0.39.1/install.sh ",["$","span",null,{"className":"token punctuation","children":"|"}]," bash\n          export NVM_DIR=\"$HOME/.nvm\"\n          ",["$","span",null,{"className":"token punctuation","children":"["}]," ",["$","span",null,{"className":"token punctuation","children":"-"}],"s \"$NVM_DIR/nvm.sh\" ",["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token important","children":"&&"}]," \\. \"$NVM_DIR/nvm.sh\"\n          ",["$","span",null,{"className":"token punctuation","children":"["}]," ",["$","span",null,{"className":"token punctuation","children":"-"}],"s \"$NVM_DIR/bash_completion\" ",["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token important","children":"&&"}]," \\. \"$NVM_DIR/bash_completion\"\n          nvm install ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"lts\n          nvm use ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"lts\n\n          ",["$","span",null,{"className":"token comment","children":"# Install PM2 and Bun globally"}],"\n          npm install ",["$","span",null,{"className":"token punctuation","children":"-"}],"g pm2 bun\n          pm2 startup systemd ",["$","span",null,{"className":"token punctuation","children":"-"}],"u $USER ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"hp $HOME\n\n          ",["$","span",null,{"className":"token comment","children":"# Install AWS-CLI"}],"\n          curl \"https",["$","span",null,{"className":"token punctuation","children":":"}],"//awscli.amazonaws.com/awscli",["$","span",null,{"className":"token punctuation","children":"-"}],"exe",["$","span",null,{"className":"token punctuation","children":"-"}],"linux",["$","span",null,{"className":"token punctuation","children":"-"}],"x86_64.zip\" ",["$","span",null,{"className":"token punctuation","children":"-"}],"o \"awscliv2.zip\"\n          unzip awscliv2.zip\n          ./aws/install\n\n          ",["$","span",null,{"className":"token comment","children":"# Variables"}],"\n          S3_PATH=\"s3",["$","span",null,{"className":"token punctuation","children":":"}],"//<bucket",["$","span",null,{"className":"token punctuation","children":"-"}],"name",["$","span",null,{"className":"token punctuation","children":">"}],"\"\n          LOCAL_PATH=\"/home/ubuntu/<bucket",["$","span",null,{"className":"token punctuation","children":"-"}],"name",["$","span",null,{"className":"token punctuation","children":">"}],"\"\n          FILE_TO_CHECK=\"<src",["$","span",null,{"className":"token punctuation","children":"-"}],"code",["$","span",null,{"className":"token punctuation","children":"-"}],"file",["$","span",null,{"className":"token punctuation","children":">"}],".zip\"\n          APP_NAME=\"<app",["$","span",null,{"className":"token punctuation","children":"-"}],"name",["$","span",null,{"className":"token punctuation","children":">"}],"\"\n\n          ",["$","span",null,{"className":"token comment","children":"# Wait for the source code to be available in S3"}],"\n          while true; do\n            aws s3 ls $S3_PATH/$FILE_TO_CHECK\n            ",["$","span",null,{"className":"token important","children":"&&"}]," break\n            ",["$","span",null,{"className":"token punctuation","children":"|"}],["$","span",null,{"className":"token punctuation","children":"|"}]," echo \"Waiting for source code to be available in S3",["$","span",null,{"className":"token punctuation","children":"..."}],"\"\n            ",["$","span",null,{"className":"token important","children":"&&"}]," sleep 300\n          done\n\n          ",["$","span",null,{"className":"token comment","children":"# Sync source code from S3"}],"\n          mkdir ",["$","span",null,{"className":"token punctuation","children":"-"}],"p $LOCAL_PATH\n          aws s3 sync $S3_PATH $LOCAL_PATH\n          unzip $LOCAL_PATH/$FILE_TO_CHECK ",["$","span",null,{"className":"token punctuation","children":"-"}],"d $LOCAL_PATH/\n          rm $LOCAL_PATH/$FILE_TO_CHECK\n          echo \"Source code pulled from S3 to $LOCAL_PATH\"\n\n          ",["$","span",null,{"className":"token comment","children":"# Move source code to web directory"}],"\n          mkdir ",["$","span",null,{"className":"token punctuation","children":"-"}],"p /var/www/$APP_NAME\n          mv $LOCAL_PATH/* /var/www/$APP_NAME/\n          cd /var/www/$APP_NAME\n\n          ",["$","span",null,{"className":"token comment","children":"# Install dependencies and build the application"}],"\n          bun install ",["$","span",null,{"className":"token punctuation","children":"-"}],["$","span",null,{"className":"token punctuation","children":"-"}],"frozen",["$","span",null,{"className":"token punctuation","children":"-"}],"lockfile\n          bun run build\n\n          ",["$","span",null,{"className":"token comment","children":"# Start the application with PM2"}],"\n          pm2 start ecosystem.config.cjs\n          pm2 save\n\n          ",["$","span",null,{"className":"token comment","children":"# Configure Nginx"}],"\n          cat ",["$","span",null,{"className":"token punctuation","children":">"}]," /etc/nginx/sites",["$","span",null,{"className":"token punctuation","children":"-"}],"available/$APP_NAME <<",["$","span",null,{"className":"token punctuation","children":"-"}]," EOF\n          server ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n              listen 80;\n              server_name <domain.com",["$","span",null,{"className":"token punctuation","children":">"}],";\n              \n              location / ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n                  proxy_pass http",["$","span",null,{"className":"token punctuation","children":":"}],"//localhost",["$","span",null,{"className":"token punctuation","children":":"}],"3000;\n                  proxy_http_version 1.1;\n                  proxy_set_header Upgrade \\$http_upgrade;\n                  proxy_set_header Connection 'upgrade';\n                  proxy_set_header Host \\$host;\n                  proxy_cache_bypass \\$http_upgrade;\n              ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n          ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n          EOF\n          ln ",["$","span",null,{"className":"token punctuation","children":"-"}],"s /etc/nginx/sites",["$","span",null,{"className":"token punctuation","children":"-"}],"available/$APP_NAME /etc/nginx/sites",["$","span",null,{"className":"token punctuation","children":"-"}],"enabled/\n          rm /etc/nginx/sites",["$","span",null,{"className":"token punctuation","children":"-"}],"enabled/default\n\n          ",["$","span",null,{"className":"token comment","children":"# Restarting server"}],"\n          systemctl restart nginx\n          pm2 restart all\n"]}]}],"\n",["$","h3",null,{"children":"Explanation and pre-requisite"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"InstanceType"}]," - ",["$","strong",null,{"children":"c5a.large"}]," is chosen as instance for compute optimization, suitable for applications that need high processing power with cost-optimization in mind."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"ImageId"}]," - The AMI used is ",["$","strong",null,{"children":"Ubuntu 22.04 LTS"}],", which provides long-term support and stability."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"SecurityGroupIds"}]," - Ensure that security group configured allows traffic on the necessary ports, especially ",["$","strong",null,{"children":"port 80"}]," for HTTP traffic."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"UserData"}]," - This section automates the initial one-time setup for the instance. It ",["$","strong",null,{"children":"installs necessary packages"}]," like Nginx, Node.js, PM2, and AWS CLI, sets up Nginx as a reverse proxy, and fetches the application code from S3."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"bun install && bun run build"}]," - This assumes that bun is used as the package manager for installing application dependencies. Alternatives like npm, yarn, etc. can also be used here."]}],"\n",["$","li",null,{"children":["Ensure that ",["$","code",null,{"children":"<IAM-instance-profile-name>"}]," created has necessary permission to read from S3 bucket, specifically the permission of ",["$","code",null,{"children":"s3:GetObject"}],"."]}],"\n",["$","li",null,{"children":["Ensure that ",["$","code",null,{"children":"<keypair-name>"}],", ",["$","code",null,{"children":"<IAM-instance-profile-name>"}],", ",["$","code",null,{"children":"<security-group-id>"}],", ",["$","code",null,{"children":"<bucket-name>"}],", ",["$","code",null,{"children":"<app-name>"}],", and ",["$","code",null,{"children":"<domain.com>"}]," parameters are replaced with their respective values."]}],"\n"]}],"\n",["$","h2",null,{"children":"Semi CI/CD Implementation using S3"}],"\n",["$","p",null,{"children":"For a semi CI/CD approach, the application code is uploaded to an S3 bucket. The EC2 instance continuously checks the S3 bucket for the presence of the deployment package and deploys it once available. But to be safe, upload the compressed source-code in the S3 bucket first before launching an EC2 using this template. This method is useful for environments where a full CI/CD pipeline isn't feasible or required."}],"\n",["$","h2",null,{"children":"Disclaimer"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"CloudFormation"}],": This template is written in YAML for deployment via CloudFormation. A solid understanding of CloudFormation is essential."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Non-Rapid Patching Environments"}],": This solution is designed for applications that do not require rapid patching. It doesn't fully integrate with a CI/CD pipeline but instead relies on an S3 bucket to store the source code. This approach is more manual and may not be ideal for high-frequency updates."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Auto Scaling Group (ASG) Considerations"}],": Since this setup doesn't use a golden image, which would typically contain a pre-configured environment, consider lowering the threshold of the ASG to reduce boot time. The reasoning behind not using a golden image is to ensure that the installed packages are always up to date."]}],"\n"]}],"\n",["$","p",null,{"children":["The original writeup was authored by Aerrata and sourced from ",["$","a",null,{"href":"https://aerrata.github.io/posts/deploy-nuxt-app-on-ubuntu-with-nginx/","children":"here"}],"."]}]]}]]}]}]}]}]}]}]}],null],null],null]},[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","writeups","children","web-app-deployment-using-pm2-in-aws","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","writeups","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/9f7cc199d69c0cf6.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"h-full antialiased","suppressHydrationWarning":true,"children":[["$","$L4",null,{"gaId":"G-V5N6BFQPX5"}],["$","body",null,{"className":"flex h-full bg-sky-100/50 dark:bg-zinc-900","children":["$","$L5",null,{"children":["$","div",null,{"className":"flex w-full","children":["$","$L6",null,{"children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"className":"sm:px-8 flex h-full items-center pt-16 sm:pt-32","children":["$","div",null,{"className":"mx-auto w-full max-w-7xl lg:px-8","children":["$","div",null,{"className":"relative px-4 sm:px-8 lg:px-12","children":["$","div",null,{"className":"mx-auto max-w-2xl lg:max-w-5xl","children":["$","div",null,{"className":"flex flex-col items-center","children":[["$","$L7",null,{"src":{"src":"/_next/static/media/404.bf539840.png","height":2000,"width":2000,"blurDataURL":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAY1BMVEVMaXGCckXy8u/y8PEgNUtXXlhaXEwjS274+fkrK0x8iY+tr6r19vVNUkqcdSzcvIX89/fjwIO7x9Dz///x//+3fhPx2rLk4NnP09SlsLe/vLD////v7+/70Yr//vn3w3DPpWKEtAD3AAAAHXRSTlMA/DCRKPXcHbQK/f79vGJ2ad+pXDf2/vr+RPiWUBIQKyQAAAAJcEhZcwAACxMAAAsTAQCanBgAAABBSURBVHicJcbFEYAwAADBixHFXRLov0pmYF8L4DU/a2r7xVeistC03RCMRvZ3LjHuuDyL9Sgn4/KELaULJuWckrxH/QKpQy6d8QAAAABJRU5ErkJggg==","blurWidth":8,"blurHeight":8},"alt":"","className":"w-60 md:w-80"}],["$","h1",null,{"className":"mt-4 text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100","children":"404: Page not found"}],["$","p",null,{"className":"mt-4 text-sm text-zinc-600 sm:text-base dark:text-zinc-400","children":"Crawl what, dude? Nothing to see here HAHA."}],["$","$L8",null,{"className":"inline-flex items-center gap-2 justify-center rounded-md py-2 px-3 text-sm outline-offset-2 transition active:transition-none bg-zinc-50 font-medium text-zinc-900 hover:bg-zinc-100 active:bg-zinc-100 active:text-zinc-900/60 dark:bg-zinc-800/50 dark:text-zinc-300 dark:hover:bg-zinc-800 dark:hover:text-zinc-50 dark:active:bg-zinc-800/50 dark:active:text-zinc-50/70 mt-4","href":"/","children":"Go back home, now!"}]]}]}]}]}]}],"notFoundStyles":[]}]}]}]}]}]]}]],null],null],["$L9",null]]]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Web-App Deployment using PM2 in AWS"}],["$","meta","3",{"name":"description","content":"Configuring web-app deployment using PM2 in EC2 utilizing launch template, and semi CI/CD implementation using S3."}]]
1:null
